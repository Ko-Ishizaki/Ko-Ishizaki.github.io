<!DOCTYPE html> <html lang="ja"> <head>   <meta charset="UTF-8">   <title>あみだくじ</title>   <meta name="viewport" content="width=device-width, initial-scale=1.0">   <style>     * { box-sizing: border-box; }     body {       font-family: sans-serif;       padding: 20px;       margin: 0;       background: #f9f9f9;     }     .section {       margin-bottom: 20px;     }     .sticky-label {       position: sticky;       top: 0;       background: #f9f9f9;       padding: 6px 0;       font-weight: bold;       z-index: 10;     }     textarea {       width: 100%;       resize: none;       overflow: hidden;       min-height: 80px;       font-size: 16px;       line-height: 1.6;       padding: 8px;       border: 1px solid #ccc;       border-radius: 4px;       background: white;     }     small {       display: block;       margin-top: 4px;       color: #666;     }     button {       width: 100%;       padding: 12px;       font-size: 16px;       background-color: #007bff;       color: white;       border: none;       border-radius: 4px;       cursor: pointer;     }     button:hover {       background-color: #0056b3;     }     canvas {       width: 100%;       height: auto;       border: 1px solid #ccc;       margin-top: 20px;       background: #fff;     }     #result {       margin-top: 20px;       font-size: 16px;       background: white;       padding: 10px;       border-radius: 4px;     }   </style> </head> <body> <h1>あみだくじ</h1> <div class="section">   <div class="sticky-label">グループ1(1行ずつ入力)</div>   <textarea id="players" class="auto-grow"></textarea> </div> <div class="section">   <div class="sticky-label">グループ2(1行ずつ入力)</div>   <textarea id="prizes" class="auto-grow"></textarea>   <small>※グループ1と同じ数だけ入力してください。</small> </div> <div class="section">   <div class="sticky-label">必ず成立させる組み合わせ（形式: ACol1:BCol1）</div>   <textarea id="mustPairs" class="auto-grow"></textarea>   <small>※「--」で始まる行はコメントとしてスキップされます</small> </div> <div class="section">   <div class="sticky-label">NGの組み合わせ（形式: ACol2:BCol2）</div>   <textarea id="ngPairs" class="auto-grow"></textarea>   <small>※「--」で始まる行はコメントとしてスキップされます</small> </div> <button onclick="startAmida()">あみだくじ開始！</button> <canvas id="amidaCanvas" height="500"></canvas> <div id="result"></div> <script>  document.querySelectorAll('.auto-grow').forEach(textarea => {   textarea.addEventListener('input', () => {     textarea.style.height = 'auto';     textarea.style.height = textarea.scrollHeight + 'px';   });   textarea.dispatchEvent(new Event('input')); }); function parseInput(id) {   return document.getElementById(id).value     .split('\n')     .map(line => line.trim())     .filter(Boolean); } function parsePairs(id) {   const raw = parseInput(id);   const pairs = {};   raw.forEach(line => {     if (line.startsWith('--')) return;      const [name, prize] = line.split(':').map(s => s.trim());     if (name && prize) {       pairs[name] = prize;     }   });   return pairs; } function shuffle(array) {   const a = [...array];   for (let i = a.length - 1; i > 0; i--) {     const j = Math.floor(Math.random() * (i + 1));     [a[i], a[j]] = [a[j], a[i]];   }   return a; } function generateAssignment(players, prizes, mustPairs, ngPairs) {   const fixed = { ...mustPairs };   const remainingPlayers = players.filter(p => !(p in fixed));   const usedPrizes = Object.values(fixed);   const remainingPrizes = prizes.filter(p => !usedPrizes.includes(p));   let assignment = {};   let valid = false;   while (!valid) {     const shuffled = shuffle(remainingPrizes);     assignment = { ...fixed };     for (let i = 0; i < remainingPlayers.length; i++) {       assignment[remainingPlayers[i]] = shuffled[i];     }        valid = true;     for (const [p, ngPrize] of Object.entries(ngPairs)) {       if (assignment[p] === ngPrize) {         valid = false;         break;       }     }   }   return assignment; } function drawAmida(players, assignment, canvas) {   const ctx = canvas.getContext('2d');   const deviceWidth = window.innerWidth;   const count = players.length;   const spacing = deviceWidth / (count + 1);   const height = canvas.height - 100;   const topMargin = 50;   canvas.width = deviceWidth;   ctx.clearRect(0, 0, canvas.width, canvas.height);   const xPositions = players.map((_, i) => spacing * (i + 1));   xPositions.forEach(x => {     ctx.beginPath();     ctx.moveTo(x, topMargin);     ctx.lineTo(x, topMargin + height);     ctx.stroke();   });    const rows = 15;   const rowHeight = height / (rows + 1);   for (let r = 0; r < rows; r++) {     const y = topMargin + (r + 1) * rowHeight;     for (let i = 0; i < players.length - 1; i++) {       if (Math.random() < 0.3) {         const x1 = xPositions[i];         const x2 = xPositions[i + 1];         ctx.beginPath();         ctx.moveTo(x1, y);         ctx.lineTo(x2, y);         ctx.stroke();       }     }   }   ctx.font = '14px sans-serif';   players.forEach((p, i) => {     ctx.fillText(p, xPositions[i] - 20, 20);     ctx.fillText(assignment[p], xPositions[i] - 20, canvas.height - 10);   }); } function startAmida() {   const players = parseInput("players");   const prizes = parseInput("prizes");   const mustPairs = parsePairs("mustPairs");   const ngPairs = parsePairs("ngPairs");   if (players.length !== prizes.length) {     alert("グループ1とグループ2は一致していません");     return;   }   const assignment = generateAssignment(players, prizes, mustPairs, ngPairs);   const canvas = document.getElementById("amidaCanvas");   drawAmida(players, assignment, canvas);   const result = document.getElementById("result");   result.innerHTML = "<h3>結果:</h3><ul>" +     players.map(p => `<li>${p} ⇔ ${assignment[p]}</li>`).join('') +     "</ul>"; } </script> </body> </html>  