<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Source Snippet</title>
  <meta name="description" content="Source Sni[[et Writen by Ishizaki">
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --bg:#0e1116; 
      --card:#121722;
      --fg:#e6edf3;
      --muted:#a7b1be;
      --border:#202635;
      --accent:#6aa9ff;
      --code-bg:#0b1320;
      --code-fg:#dbe6ff;
      --radius:12px;
      --tap:44px;
      --pad:clamp(14px,3.2vw,22px);
      --shadow:0 1px 0 var(--border), 0 10px 24px rgba(0,0,0,.25);
    }

    *{box-sizing:border-box}
    html,body{
      margin:0; background:var(--bg); color:var(--fg);
      font: clamp(15px,1.7vw,16.5px)/1.7 ui-sans-serif,system-ui,-apple-system,
            "Segoe UI",Roboto,"Helvetica Neue","Noto Sans JP",
            "Hiragino Kaku Gothic ProN","Yu Gothic UI","Yu Gothic",Arial,sans-serif;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    :focus-visible{outline:2px solid var(--accent);outline-offset:3px;border-radius:8px}

    .container{
      max-width:960px;margin-inline:auto;padding:var(--pad);
      padding-left:max(var(--pad),env(safe-area-inset-left));
      padding-right:max(var(--pad),env(safe-area-inset-right));
    }

    header{
      position:sticky; top:0; z-index:10; background:var(--bg);
      border-bottom:1px solid var(--border);
      padding-top:env(safe-area-inset-top);
    }
    .head{display:flex;align-items:center;justify-content:space-between;gap:12px;min-height:56px}
    h1{margin:0;font-size:clamp(1rem,2.6vw,1.15rem);letter-spacing:.2px}
    .muted{color:var(--muted);font-size:.92rem}

    .controls{display:flex;gap:8px;align-items:center}
    #search{
      width:min(100%,520px); height:var(--tap);
      padding:10px 12px; border:1px solid var(--border); border-radius:999px;
      background:var(--card); color:var(--fg);
      outline:none;
    }

    main{padding-block: clamp(8px,2.5vw,16px)}
    #snippets{display:grid;gap:clamp(12px,2.5vw,16px)}
    article{
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding: clamp(12px,2.6vw,16px);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    h2{margin:0;font-size:clamp(.98rem,2.5vw,1.05rem)}
    h2[id]{scroll-margin-top:72px}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:.8rem;color:var(--muted);padding:2px 10px;border:1px solid var(--border);border-radius:999px}

    pre{
      margin:10px 0 0; padding:12px; overflow:auto;
      background:var(--code-bg); color:var(--code-fg);
      border:1px solid var(--border); border-radius:10px;
      -webkit-overflow-scrolling:touch; overscroll-behavior:contain;
    }
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono","Courier New",monospace;
         font-size:clamp(.88rem,2.3vw,.95rem)}

    .copy{
      border:1px solid var(--border); background:transparent; color:var(--fg);
      border-radius:10px; padding:0 12px; height:var(--tap); min-width:calc(var(--tap) * 1.4);
      display:inline-flex; align-items:center; justify-content:center; cursor:pointer;
    }
    .copy:hover{border-color:var(--accent)}

    #empty{
      display:none; margin-top:10px; text-align:center;
      border:1px dashed var(--border); border-radius:10px; padding:18px; color:var(--muted);
    }
    footer{border-top:1px solid var(--border);margin-top:clamp(12px,3vw,20px);padding-top:10px;padding-bottom:env(safe-area-inset-bottom)}

    @media (min-width:720px){ #snippets{gap:18px} }
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="head">
      <h1>Source Snippet</h1>
      <div class="controls">
        <input id="search" type="search" inputmode="search" enterkeyhint="search"
               placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ / ã‚¿ã‚°ã§æ¤œç´¢" autocomplete="off" />
      </div>
    </div>
  </div>
</header>

<main class="container" role="main">
  <section id="snippets" aria-live="polite">

    <article>
      <div class="row">
        <h2 id="ps-get-path">å®Ÿè¡ŒPCã®IPã®ã¿ã‚’è¡¨ç¤ºï¼ˆPowerShellï¼‰</h2>
        <div class="tags"><span class="tag">powershell</span><span class="tag">windows</span></div>
      </div>
      <pre><code class="language-powershell">(Get-NetIPAddress -AddressFamily IPv4 |
      Where-Object {$_.IPAddress -notlike '169.*' -and $_.IPAddress -ne '127.0.0.1'}).IPAddress</code></pre>
      <div class="row" style="margin-top:8px">
        <button class="copy" data-for="ps-get-path" aria-label="ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </article>

    <article>
      <div class="row">
        <h2 id="ps-allow-rdp">ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®è¨±å¯ï¼ˆPowerShellï¼‰</h2>
        <div class="tags"><span class="tag">powershell</span><span class="tag">windows</span></div>
      </div>
      <pre><code class="language-powershell">$sg=(powercfg /getactivescheme) -replace '.*:\s+|\s+\(.*','';$st=@(@{n='ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®é›»æºã‚’åˆ‡ã‚‹ï¼ˆãƒãƒƒãƒ†ãƒªé§†å‹•ï¼‰';g='SUB_VIDEO';k='3c0bc021-c8a8-4e07-a973-6b14cbcb2b7e';m='dc'},@{n='ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®é›»æºã‚’åˆ‡ã‚‹ï¼ˆé›»æºã«æ¥ç¶šï¼‰';g='SUB_VIDEO';k='3c0bc021-c8a8-4e07-a973-6b14cbcb2b7e';m='ac'},@{n='ã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆãƒãƒƒãƒ†ãƒªé§†å‹•ï¼‰';g='SUB_SLEEP';k='29f6c1db-86da-48c5-9fdb-f2b67b1f44da';m='dc'},@{n='ã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆé›»æºã«æ¥ç¶šï¼‰';g='SUB_SLEEP';k='29f6c1db-86da-48c5-9fdb-f2b67b1f44da';m='ac'});function gt($g,$k,$m){$t=New-TemporaryFile;powercfg -query SCHEME_CURRENT $g $k > $t.FullName 2>$null;$l=Get-Content $t.FullName;Remove-Item $t -Force;if($m -eq 'ac' -and ($l -match 'AC.*ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹.*:\s*0x([0-9a-fA-F]+)')){[math]::Round(([convert]::ToInt32($matches[1],16))/60)}elseif($m -eq 'dc' -and ($l -match 'DC.*ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹.*:\s*0x([0-9a-fA-F]+)')){[math]::Round(([convert]::ToInt32($matches[1],16))/60)}else{-1}};Write-Host "`nğŸ” ç¾åœ¨ã®è¨­å®š:";$st|%{ $_.before=gt $_.g $_.k $_.m;Write-Host ("  {0}: {1} åˆ†" -f $_.n,$_.before)};$sec=0;Write-Host "`nğŸ”§ ä¸€å¾‹ã§ 0 åˆ†ã«å¤‰æ›´ä¸­...";$st|%{if($_.m -eq 'ac'){powercfg -setacvalueindex $sg $_.g $_.k $sec}else{powercfg -setdcvalueindex $sg $_.g $_.k $sec}};powercfg -S $sg; $st|%{ $_.after=gt $_.g $_.k $_.m};Write-Host "`nâœ… å¤‰æ›´å¾Œ:";$st|%{Write-Host ("  {0}: {1} åˆ†" -f $_.n,$_.after)};Write-Host "`nâ¹ ç¶šè¡Œã™ã‚‹ã«ã¯ä½•ã‹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ï¼ˆç”»é¢ã‚’ã‚¯ãƒªã‚¢ã—ã¦çµ‚äº†ã—ã¾ã™ï¼‰...";try{$null=$Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown')}catch{Read-Host '> Enter ã‚’æŠ¼ã—ã¦ãã ã•ã„'|Out-Null};Clear-Host;exit
            </code></pre>
      <div class="row" style="margin-top:8px">
        <button class="copy" data-for="ps-allow-rdp" aria-label="ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </article>


    <article>
      <div class="row">
        <h2 id="ps-change-battery-plan">ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®è¨±å¯ï¼ˆPowerShellï¼‰</h2>
        <div class="tags"><span class="tag">powershell</span><span class="tag">windows</span></div>
      </div>
      <pre><code class="language-powershell">
# System_LocateãŒJPé™å®šã§ã™ã€‚
# æ—¥æœ¬ã«ã„ã‚‹äººå‘ã‘ã®è¨­å®šæ›´æ–°ã«ãªã‚Šã¾ã™ã€‚
function Admin {
    $identity = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = New-Object Security.Principal.WindowsPrincipal($identity)
    return $principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
}

# ç®¡ç†è€…ã§ãªã‘ã‚Œã°å†èµ·å‹•
if (-not (Admin)) {
    Write-Host "ğŸ” ç®¡ç†è€…æ¨©é™ã§å†èµ·å‹•ã—ã¾ã™..."
    $script = $MyInvocation.MyCommand.Definition
    Start-Process powershell.exe -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File `"$script`"" -Verb RunAs
    exit
}

# ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³IDå–å¾—
$schemeGuid = (powercfg /getactivescheme) -replace '.*:\s+|\s+\(.*', ''

# è¨­å®šä¸€è¦§ï¼ˆGUIDãƒ™ãƒ¼ã‚¹ã§å®šç¾©ï¼‰
$settings = @(
    @{ id = "1"; name = "ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®é›»æºã‚’åˆ‡ã‚‹ï¼ˆãƒãƒƒãƒ†ãƒªé§†å‹•ï¼‰"; group = "SUB_VIDEO"; subKey = "3c0bc021-c8a8-4e07-a973-6b14cbcb2b7e"; mode = "dc" },
    @{ id = "2"; name = "ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®é›»æºã‚’åˆ‡ã‚‹ï¼ˆé›»æºã«æ¥ç¶šï¼‰"; group = "SUB_VIDEO"; subKey = "3c0bc021-c8a8-4e07-a973-6b14cbcb2b7e"; mode = "ac" },
    @{ id = "3"; name = "ã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆãƒãƒƒãƒ†ãƒªé§†å‹•ï¼‰"; group = "SUB_SLEEP"; subKey = "29f6c1db-86da-48c5-9fdb-f2b67b1f44da"; mode = "dc" },
    @{ id = "4"; name = "ã‚¹ãƒªãƒ¼ãƒ—çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆé›»æºã«æ¥ç¶šï¼‰"; group = "SUB_SLEEP"; subKey = "29f6c1db-86da-48c5-9fdb-f2b67b1f44da"; mode = "ac" }
)

# ç¾åœ¨å€¤å–å¾—
function Get-TimeoutValue {
    param (
        [string]$subgroup,
        [string]$settingGuid,
        [string]$mode
    )
    $tempFile = New-TemporaryFile
    powercfg -query SCHEME_CURRENT $subgroup $settingGuid > $tempFile.FullName 2>$null
    $lines = Get-Content $tempFile.FullName
    Remove-Item $tempFile -Force

    foreach ($line in $lines) {
        if ($mode -eq "ac" -and $line -match "AC.*ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹.*:\s*0x([0-9a-fA-F]+)") {
            return [math]::Round(([convert]::ToInt32($matches[1], 16)) / 60)
        }
        if ($mode -eq "dc" -and $line -match "DC.*ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹.*:\s*0x([0-9a-fA-F]+)") {
            return [math]::Round(([convert]::ToInt32($matches[1], 16)) / 60)
        }
    }

    return -1
}

# è¡¨ç¤º
Write-Host "`nğŸ” ç¾åœ¨ã®è¨­å®š:"
foreach ($s in $settings) {
    $s.minutes = Get-TimeoutValue $s.group $s.subKey $s.mode
    Write-Host "  [$($s.id)] $($s.name): $($s.minutes) åˆ†"
}
Write-Host "  [0] ã‚„ã‚ã‚‹ï¼ˆçµ‚äº†ï¼‰"
Write-Host "  [5] ç¾åœ¨ã®è¨­å®šã‚’å†èª­ã¿è¾¼ã¿"
Write-Host "  [6] ã™ã¹ã¦ã€Œ0 åˆ†ã€ã«ã™ã‚‹"
Write-Host "  [7] ã™ã¹ã¦ã€Œ1 åˆ†ã€ã«ã™ã‚‹"

# è¨­å®šå¤‰æ›´ãƒ«ãƒ¼ãƒ—
do {
    $choice = Read-Host "`nå¤‰æ›´ã—ãŸã„è¨­å®šã®ç•ªå·ã‚’é¸ã‚“ã§ãã ã•ã„ï¼ˆ0ã§çµ‚äº† / 5ã§å†èª­ã¿è¾¼ã¿ï¼‰"
    
    if ($choice -eq "0") {
        Write-Host "`nğŸ‘‹ çµ‚äº†ã—ã¾ã™ã€‚"
        break
    }

    if ($choice -eq "5") {
        Write-Host "`nğŸ”„ è¨­å®šã‚’å†å–å¾—ä¸­..."
        foreach ($s in $settings) {
            $s.minutes = Get-TimeoutValue $s.group $s.subKey $s.mode
            Write-Host "  [$($s.id)] $($s.name): $($s.minutes) åˆ†"
        }
        continue
    }

    if ($choice -eq "6" -or $choice -eq "7") {
        $newMinutes = if ($choice -eq "6") { 0 } else { 1 }
        $seconds = $newMinutes * 60
        Write-Host "`nğŸ”§ ã™ã¹ã¦ã®è¨­å®šã‚’ $newMinutes åˆ†ã«å¤‰æ›´ä¸­..."

        foreach ($s in $settings) {
            if ($s.mode -eq "ac") {
                powercfg -setacvalueindex $schemeGuid $s.group $s.subKey $seconds
            } else {
                powercfg -setdcvalueindex $schemeGuid $s.group $s.subKey $seconds
            }
        }

        powercfg -S $schemeGuid
        Write-Host "âœ… ä¸€æ‹¬è¨­å®šå®Œäº†ï¼"

        foreach ($s in $settings) {
            $s.minutes = Get-TimeoutValue $s.group $s.subKey $s.mode
        }
        continue
    }

    $target = $settings | Where-Object { $_.id -eq $choice }
    if (-not $target) {
        Write-Host "âŒ ç„¡åŠ¹ãªé¸æŠã§ã™ã€‚"
        continue
    }

    Write-Host "`nâ² æ–°ã—ã„æ™‚é–“ã‚’å…¥åŠ›ï¼ˆå˜ä½ï¼šåˆ†ï¼‰"
    Write-Host "  â€» 0 ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€é©ç”¨ã—ãªã„ã€ã«ãªã‚Šã¾ã™ã€‚"
    do {
        $input = Read-Host "ç¾åœ¨å€¤: $($target.minutes) åˆ† â†’ æ–°ã—ã„å€¤ï¼ˆåˆ†ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
    } until ($input -match '^\d+$')

    $newMinutes = [int]$input
    $seconds = $newMinutes * 60

    Write-Host "ğŸ›  è¨­å®šå¤‰æ›´ä¸­: $($target.name) â†’ $newMinutes åˆ†..."

    if ($target.mode -eq "ac") {
        powercfg -setacvalueindex $schemeGuid $target.group $target.subKey $seconds
    } else {
        powercfg -setdcvalueindex $schemeGuid $target.group $target.subKey $seconds
    }

    powercfg -S $schemeGuid  # å¤‰æ›´ã‚’æœ‰åŠ¹ã«ã™ã‚‹

    Write-Host "âœ… è¨­å®šå®Œäº†ï¼"

    # æ›´æ–°å¾Œã®å€¤ã‚’å†å–å¾—
    $target.minutes = Get-TimeoutValue $target.group $target.subKey $target.mode

} while ($true)        
            </code></pre>
      <div class="row" style="margin-top:8px">
        <button class="copy" data-for="ps-change-battery-plan" aria-label="ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </article>
    <article>
      <div class="row">
        <h2 id="ps-listen-ports">å¾…ã¡å—ã‘ãƒãƒ¼ãƒˆã‚’ç¢ºèªï¼ˆPowerShellï¼‰</h2>
        <div class="tags"><span class="tag">powershell</span><span class="tag">network</span></div>
      </div>
      <pre><code class="language-powershell">Get-NetTCPConnection -State Listen |
  Sort-Object -Property LocalPort |
  Select-Object LocalAddress,LocalPort,OwningProcess</code></pre>
      <div class="row" style="margin-top:8px">
        <button class="copy" data-for="ps-listen-ports" aria-label="ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </article>

    <article>
      <div class="row">
        <h2 id="git-amend">ç›´å‰ã‚³ãƒŸãƒƒãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›´ã™ï¼ˆGitï¼‰</h2>
        <div class="tags"><span class="tag">git</span><span class="tag">shell</span></div>
      </div>
      <pre><code class="language-bash">git commit --amend -m "fix: æ­£ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ›´æ–°"</code></pre>
      <div class="row" style="margin-top:8px">
        <button class="copy" data-for="git-amend" aria-label="ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </article>

  </section>

  <div id="empty">è©²å½“ã™ã‚‹é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>

  <footer class="muted">Copyright Ishizaki 2025</footer>
</main>

<script>
  (function(){
    const q=document.getElementById('search');
    const list=document.getElementById('snippets');
    const empty=document.getElementById('empty');
    let t=0;
    function filter(){
      const terms=(q.value||'').toLowerCase().split(/\s+/).filter(Boolean);
      let shown=0;
      list.querySelectorAll('article').forEach(a=>{
        const hay=(a.textContent+' '+(a.dataset.tags||'')).toLowerCase();
        const ok=terms.every(t=>hay.includes(t));
        a.style.display=ok?'':'none';
        if(ok) shown++;
      });
      empty.style.display= shown? 'none':'block';
      history.replaceState(null,'',location.pathname+(q.value?('#q='+encodeURIComponent(q.value)):''));
    }
    q.addEventListener('input',()=>{ clearTimeout(t); t=setTimeout(filter, 80); });
    if(location.hash.startsWith('#q=')){ q.value=decodeURIComponent(location.hash.slice(3)); filter(); }
  })();

  (function(){
    function getCode(id){
      const h=document.getElementById(id);
      const pre=h?.parentElement?.nextElementSibling;
      return pre? pre.innerText : '';
    }
    document.querySelectorAll('.copy').forEach(b=>{
      b.addEventListener('click',async()=>{
        const text=getCode(b.dataset.for);
        try{
          await navigator.clipboard.writeText(text);
          const t=b.textContent; b.textContent='âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
          setTimeout(()=>b.textContent=t, 1100);
        }catch(e){ alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—: '+e); }
      });
    });
  })();
</script>
</body>
</html>
